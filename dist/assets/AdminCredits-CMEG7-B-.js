import{p as $,n as A,q as G,o as u,t as M,m as T,w as B,u as E,r as c,j as e}from"./index-CVlme_lB.js";import{a as F,b as N,g as R}from"./appCredits-CjbISwcd.js";function v(s,i){return T(A,"users",s,"apps",i)}async function P(s,i){if(!N(i))throw new Error(`Unknown app: ${i}`);const n=v(s,i),d=await u(n);if(d.exists())return d.data();const a=F(i);return await B(n,a),console.log(`[CreditService] Initialized credits for user ${s}, app ${i}`),a}async function q(s,i,l){const n=v(s,i);(await u(n)).exists()||await P(s,i);const a={};return typeof l.creditsRemaining=="number"&&(a.creditsRemaining=Math.max(0,l.creditsRemaining)),typeof l.monthlyLimit=="number"&&(a.monthlyLimit=Math.max(1,l.monthlyLimit)),Object.keys(a).length>0&&(await M(n,a),console.log(`[CreditService] Modified credits for user ${s}, app ${i}:`,a)),(await u(n)).data()}async function I(s){const i=$(A,"users"),l=await G(i),n=[];for(const d of l.docs){const a=d.id,m=d.data(),g=v(a,s),x=await u(g);x.exists()&&n.push({uid:a,email:m.email,displayName:m.displayName,...x.data()})}return n}function V({appId:s}){const{userRole:i,isSupervisor:l}=E(),[n,d]=c.useState(s||R()[0]),[a,m]=c.useState([]),[g,x]=c.useState(!0),[w,b]=c.useState(null),[f,y]=c.useState(null),[p,h]=c.useState({creditsRemaining:0,monthlyLimit:0}),[j,S]=c.useState(!1),k=N(n),C=R();c.useEffect(()=>{n&&(async()=>{try{x(!0),b(null);const r=await I(n);m(r)}catch(r){console.error("[AppCreditsOverview] Error:",r),b(r.message)}finally{x(!1)}})()},[n]);const L=t=>{y(t.uid),h({creditsRemaining:t.creditsRemaining,monthlyLimit:t.monthlyLimit})},D=()=>{y(null),h({creditsRemaining:0,monthlyLimit:0})},U=async t=>{try{S(!0),await q(t,n,p),m(r=>r.map(o=>o.uid===t?{...o,...p}:o)),y(null)}catch(r){console.error("[AppCreditsOverview] Save error:",r),b(r.message)}finally{S(!1)}},z=a.reduce((t,r)=>t+(r.totalUsedThisMonth||0),0),O=a.reduce((t,r)=>t+(r.creditsRemaining||0),0);return e.jsxs("div",{className:"space-y-4",children:[!s&&C.length>1&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-sm font-medium",children:"App:"}),e.jsx("select",{value:n,onChange:t=>d(t.target.value),className:"h-10 px-3 rounded-lg border border-theme bg-card focus:ring-2 focus:ring-[#2860E0] focus:border-transparent",children:C.map(t=>{const r=N(t);return e.jsx("option",{value:t,children:r?.appName||t},t)})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-card rounded-lg border border-theme p-4",children:[e.jsx("p",{className:"text-secondary text-sm",children:"Gebruikers"}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:a.length})]}),e.jsxs("div",{className:"bg-card rounded-lg border border-theme p-4",children:[e.jsx("p",{className:"text-secondary text-sm",children:"Totaal Gebruikt"}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:z}),e.jsx("p",{className:"text-xs text-secondary",children:k?.creditUnitPlural})]}),e.jsxs("div",{className:"bg-card rounded-lg border border-theme p-4",children:[e.jsx("p",{className:"text-secondary text-sm",children:"Totaal Resterend"}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:O}),e.jsx("p",{className:"text-xs text-secondary",children:k?.creditUnitPlural})]})]}),w&&e.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500 rounded-lg text-red-500",children:w}),e.jsx("div",{className:"bg-card rounded-lg border border-theme overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800 border-b border-theme",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 font-semibold",children:"Gebruiker"}),e.jsx("th",{className:"text-center px-4 py-3 font-semibold",children:"Resterend"}),e.jsx("th",{className:"text-center px-4 py-3 font-semibold",children:"Limiet"}),e.jsx("th",{className:"text-center px-4 py-3 font-semibold",children:"Gebruikt"}),l&&e.jsx("th",{className:"text-right px-4 py-3 font-semibold",children:"Acties"})]})}),e.jsx("tbody",{children:g?e.jsx("tr",{children:e.jsx("td",{colSpan:l?5:4,className:"px-4 py-8 text-center",children:e.jsx("span",{className:"material-symbols-outlined animate-spin text-2xl",children:"sync"})})}):a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:l?5:4,className:"px-4 py-8 text-center text-secondary",children:"Geen gebruikers met credits voor deze app"})}):a.map(t=>e.jsxs("tr",{className:"border-b border-theme last:border-0 hover:bg-gray-500/5",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.displayName||"Onbekend"}),e.jsx("p",{className:"text-sm text-secondary",children:t.email})]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:f===t.uid?e.jsx("input",{type:"number",value:p.creditsRemaining,onChange:r=>h(o=>({...o,creditsRemaining:parseInt(r.target.value)||0})),className:"w-20 h-8 px-2 text-center rounded border border-theme bg-gray-100 dark:bg-gray-700",min:"0"}):e.jsx("span",{className:t.creditsRemaining<=0?"text-red-500 font-medium":"",children:t.creditsRemaining})}),e.jsx("td",{className:"px-4 py-3 text-center",children:f===t.uid?e.jsx("input",{type:"number",value:p.monthlyLimit,onChange:r=>h(o=>({...o,monthlyLimit:parseInt(r.target.value)||1})),className:"w-20 h-8 px-2 text-center rounded border border-theme bg-gray-100 dark:bg-gray-700",min:"1"}):t.monthlyLimit}),e.jsx("td",{className:"px-4 py-3 text-center text-secondary",children:t.totalUsedThisMonth||0}),l&&e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center justify-end gap-2",children:f===t.uid?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>U(t.uid),disabled:j,className:"p-2 rounded-lg bg-green-500 text-white hover:bg-green-600 disabled:opacity-50 transition-colors",title:"Opslaan",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:j?"sync":"check"})}),e.jsx("button",{onClick:D,disabled:j,className:"p-2 rounded-lg hover:bg-gray-500/10 transition-colors",title:"Annuleren",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]}):e.jsx("button",{onClick:()=>L(t),className:"p-2 rounded-lg hover:bg-gray-500/10 transition-colors",title:"Bewerken",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})})})})]},t.uid))})]})})]})}function K(){const{isSupervisor:s}=E();return e.jsxs("div",{className:"space-y-6 max-w-7xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Credits"}),e.jsx("p",{className:"text-secondary mt-1",children:s?"Beheer credits en limieten per gebruiker":"Bekijk credit gebruik per app en gebruiker"})]}),e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-medium ${s?"bg-purple-500/10 text-purple-600 dark:text-purple-400":"bg-blue-500/10 text-blue-600 dark:text-blue-400"}`,children:[e.jsx("span",{className:"material-symbols-outlined text-sm",children:s?"edit":"visibility"}),s?"Volledig beheer":"Alleen-lezen"]})]}),e.jsx(V,{}),!s&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-500/10 rounded-lg text-blue-600 dark:text-blue-400",children:[e.jsx("span",{className:"material-symbols-outlined",children:"info"}),e.jsx("p",{className:"text-sm",children:"Als admin heb je alleen-lezen toegang. Neem contact op met een supervisor voor het wijzigen van credits."})]})]})}export{K as default};
