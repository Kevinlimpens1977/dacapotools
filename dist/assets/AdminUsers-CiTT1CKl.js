import{u as O,r as d,j as e,R as i,p as U,n as h,q as C,o as I,m as b,t as G,w as z}from"./index-CVlme_lB.js";const n={NONE:"none",EDITOR:"editor",ADMIN:"admin"};function M(){const{isSupervisor:c,user:N}=O(),[o,g]=d.useState([]),[E,j]=d.useState(!0),[y,p]=d.useState(null),[k,f]=d.useState(!1),[v,u]=d.useState(null),[D,w]=d.useState(!1);d.useEffect(()=>{(async()=>{try{j(!0);const l=U(h,"users"),t=await C(l),r=await Promise.all(t.docs.map(async a=>{const x={id:a.id,...a.data()};try{const m=await I(b(h,"users",a.id,"apps","nieuwsbrief"));x.newsletterRole=m.exists()&&m.data().role||n.NONE}catch(m){console.error("Error fetching newsletter role for user:",a.id,m),x.newsletterRole=n.NONE}return x}));r.sort((a,x)=>(a.email||"").localeCompare(x.email||"")),g(r)}catch(l){console.error("Error fetching users:",l)}finally{j(!1)}})()},[]);const S=async(s,l)=>{try{f(!0);const t=b(h,"users",s);await G(t,{role:l}),g(r=>r.map(a=>a.id===s?{...a,role:l}:a)),p(null)}catch(t){console.error("Error updating role:",t)}finally{f(!1)}},A=async(s,l)=>{try{w(!0);const t=b(h,"users",s,"apps","nieuwsbrief");await z(t,{role:l,updatedAt:new Date,updatedBy:N.uid},{merge:!0}),g(r=>r.map(a=>a.id===s?{...a,newsletterRole:l}:a)),u(null)}catch(t){console.error("Error updating newsletter role:",t)}finally{w(!1)}},L=s=>{switch(s){case i.SUPERVISOR:return{label:"Supervisor",class:"bg-purple-500/10 text-purple-600 dark:text-purple-400"};case i.ADMIN:return{label:"Admin",class:"bg-blue-500/10 text-blue-600 dark:text-blue-400"};default:return{label:"Gebruiker",class:"bg-gray-500/10 text-gray-600 dark:text-gray-400"}}},R=s=>{switch(s){case n.ADMIN:return{label:"Admin",class:"bg-emerald-500/10 text-emerald-600 dark:text-emerald-400"};case n.EDITOR:return{label:"Editor",class:"bg-cyan-500/10 text-cyan-600 dark:text-cyan-400"};default:return{label:"Geen",class:"bg-gray-500/10 text-gray-600 dark:text-gray-400"}}};return E?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("span",{className:"material-symbols-outlined text-4xl animate-spin text-[#2860E0]",children:"sync"})}):e.jsxs("div",{className:"space-y-6 max-w-7xl",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Gebruikers"}),e.jsx("p",{className:"text-secondary mt-1",children:"Beheer alle gebruikers en hun rollen"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-card rounded-xl border border-theme p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"size-12 rounded-lg bg-blue-500/10 flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-blue-500",children:"group"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:o.length}),e.jsx("p",{className:"text-sm text-secondary",children:"Totaal Gebruikers"})]})]})}),e.jsx("div",{className:"bg-card rounded-xl border border-theme p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"size-12 rounded-lg bg-purple-500/10 flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-purple-500",children:"shield_person"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:o.filter(s=>s.role===i.SUPERVISOR||s.role===i.ADMIN).length}),e.jsx("p",{className:"text-sm text-secondary",children:"Beheerders"})]})]})}),e.jsx("div",{className:"bg-card rounded-xl border border-theme p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"size-12 rounded-lg bg-green-500/10 flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-green-500",children:"schedule"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:o.filter(s=>{if(!s.lastLogin)return!1;const l=s.lastLogin.toDate?.()||new Date(s.lastLogin),t=new Date;return t.setDate(t.getDate()-7),l>t}).length}),e.jsx("p",{className:"text-sm text-secondary",children:"Actief (7 dagen)"})]})]})})]}),e.jsx("div",{className:"bg-card rounded-xl border border-theme overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800/50 border-b border-theme",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 font-semibold",children:"Gebruiker"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold",children:"Rol"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold",children:"Nieuwsbrief Generator"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold",children:"Laatste Login"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold",children:"Aangemaakt"}),c&&e.jsx("th",{className:"text-right px-4 py-3 font-semibold",children:"Acties"})]})}),e.jsx("tbody",{children:o.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:c?6:5,className:"px-4 py-12 text-center text-secondary",children:[e.jsx("span",{className:"material-symbols-outlined text-4xl mb-2 block",children:"group"}),e.jsx("p",{children:"Geen gebruikers gevonden"})]})}):o.map(s=>{const l=L(s.role),t=s.id===N?.uid;return e.jsxs("tr",{className:"border-b border-theme last:border-0 hover:bg-gray-50 dark:hover:bg-gray-800/30",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"size-10 rounded-full bg-[#2860E0] flex items-center justify-center text-white font-medium shrink-0",children:(s.displayName||s.email||"?").charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium flex items-center gap-2",children:[s.displayName||"Onbekend",t&&e.jsx("span",{className:"text-xs text-secondary",children:"(jij)"})]}),e.jsx("p",{className:"text-sm text-secondary",children:s.email})]})]})}),e.jsx("td",{className:"px-4 py-3",children:y===s.id?e.jsxs("select",{value:s.role||i.USER,onChange:r=>S(s.id,r.target.value),disabled:k,className:"px-3 py-1.5 rounded-lg border border-theme bg-white dark:bg-gray-800 text-sm",children:[e.jsx("option",{value:i.USER,children:"Gebruiker"}),e.jsx("option",{value:i.ADMIN,children:"Admin"}),e.jsx("option",{value:i.SUPERVISOR,children:"Supervisor"})]}):e.jsx("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium ${l.class}`,children:l.label})}),e.jsx("td",{className:"px-4 py-3",children:c&&v===s.id?e.jsxs("select",{value:s.newsletterRole||n.NONE,onChange:r=>A(s.id,r.target.value),disabled:D,className:"px-3 py-1.5 rounded-lg border border-theme bg-white dark:bg-gray-800 text-sm",children:[e.jsx("option",{value:n.NONE,children:"Geen"}),e.jsx("option",{value:n.EDITOR,children:"Editor"}),e.jsx("option",{value:n.ADMIN,children:"Admin"})]}):e.jsx("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium ${R(s.newsletterRole).class}`,children:R(s.newsletterRole).label})}),e.jsx("td",{className:"px-4 py-3 text-secondary text-sm",children:s.lastLogin?new Date(s.lastLogin.toDate?.()||s.lastLogin).toLocaleDateString("nl-NL",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}),e.jsx("td",{className:"px-4 py-3 text-secondary text-sm",children:s.createdAt?new Date(s.createdAt.toDate?.()||s.createdAt).toLocaleDateString("nl-NL",{day:"numeric",month:"short",year:"numeric"}):"-"}),c&&e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center justify-end gap-1",children:y===s.id||v===s.id?e.jsx("button",{onClick:()=>{p(null),u(null)},className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",title:"Annuleren",children:e.jsx("span",{className:"material-symbols-outlined",children:"close"})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>p(s.id),className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",title:"Rol wijzigen",disabled:t,children:e.jsx("span",{className:"material-symbols-outlined",children:"edit"})}),e.jsx("button",{onClick:()=>u(s.id),className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",title:"Nieuwsbrief rol wijzigen",children:e.jsx("span",{className:"material-symbols-outlined",children:"mail"})})]})})})]},s.id)})})]})}),!c&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-500/10 rounded-lg text-blue-600 dark:text-blue-400",children:[e.jsx("span",{className:"material-symbols-outlined",children:"info"}),e.jsx("p",{className:"text-sm",children:"Als admin heb je alleen-lezen toegang. Neem contact op met een supervisor voor het wijzigen van gebruikersrollen."})]})]})}export{M as default};
