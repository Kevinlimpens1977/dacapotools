import{u as R,r as x,j as e,p as C,n as S,B as G,C as _,q as E}from"./index-BbC9A4N7.js";function T(){const{isAdmin:o}=R(),[h,m]=x.useState(!0),[b,g]=x.useState([]),[d,w]=x.useState(8);x.useEffect(()=>{(async()=>{try{m(!0);const n=C(S,"apps/nieuwsbrief/items"),a=G(n,_("createdAt","desc")),l=(await E(a)).docs.map(p=>({id:p.id,...p.data()}));g(l)}catch(n){console.error("Error fetching newsletter data:",n),g([])}finally{m(!1)}})()},[d]);const i=x.useMemo(()=>{const s=new Date,n=new Date(s.getFullYear(),s.getMonth(),s.getDate()-d*7),a=b.filter(r=>(r.createdAt?.toDate?r.createdAt.toDate():new Date(r.createdAt))>=n),t=a.length,l=a.filter(r=>r.status==="pending").length,p=a.filter(r=>r.status==="approved").length,j=a.filter(r=>r.status==="approved"&&r.approvedAt&&r.createdAt),B=j.length>0?j.reduce((r,c)=>{const W=c.createdAt?.toDate?c.createdAt.toDate():new Date(c.createdAt),O=c.approvedAt?.toDate?c.approvedAt.toDate():new Date(c.approvedAt);return r+(O-W)/(1e3*60*60)},0)/j.length:0,y={};a.forEach(r=>{const c=r.week||N(r.createdAt);y[c]=(y[c]||0)+1});const f={};a.forEach(r=>{const c=r.submittedBy||"Unknown";f[c]=(f[c]||0)+1});const v={};return a.forEach(r=>{const c=r.doelgroep||"Onbekend";v[c]=(v[c]||0)+1}),{totalItems:t,pendingItems:l,approvedItems:p,approvalRatio:t>0?(p/t*100).toFixed(1):0,avgApprovalTime:B.toFixed(1),itemsByWeek:y,itemsByUser:f,itemsByDoelgroep:v}},[b,d]),k=x.useMemo(()=>{const s=[],n=new Date;for(let a=d-1;a>=0;a--){const t=new Date(n.getFullYear(),n.getMonth(),n.getDate()-a*7),l=N(t);s.push(`Week ${l}`)}return s},[d]),u=(s,n)=>{const a=new Blob([s],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a"),l=URL.createObjectURL(a);t.setAttribute("href",l),t.setAttribute("download",n),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t)},D=()=>{const s=new Date().toISOString().split("T")[0],a=[["Week","Aantal Items"],...Object.entries(i.itemsByWeek).map(([t,l])=>[`Week ${t}`,l])].map(t=>t.join(",")).join(`
`);u(a,`nieuwsbrief_per_week_${d}w_${s}.csv`)},A=()=>{const s=new Date().toISOString().split("T")[0],a=[["Gebruiker","Aantal Submissions"],...Object.entries(i.itemsByUser).sort(([,t],[,l])=>l-t).map(([t,l])=>[t,l])].map(t=>t.join(",")).join(`
`);u(a,`nieuwsbrief_per_user_${d}w_${s}.csv`)},I=()=>{const s=new Date().toISOString().split("T")[0],a=[["Doelgroep","Aantal Items"],...Object.entries(i.itemsByDoelgroep).map(([t,l])=>[t,l])].map(t=>t.join(",")).join(`
`);u(a,`nieuwsbrief_doelgroep_${d}w_${s}.csv`)};return o?h?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("span",{className:"material-symbols-outlined text-4xl animate-spin text-[#2860E0]",children:"sync"})}):e.jsxs("div",{className:"space-y-6 max-w-7xl",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Nieuwsbrief Analytics"}),e.jsx("p",{className:"text-secondary mt-1",children:"Inzichten in nieuwsbrief submissions en goedkeuringen"})]}),e.jsxs("div",{className:"bg-card rounded-xl border border-theme p-5",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Periode"}),e.jsxs("select",{value:d,onChange:s=>w(Number(s.target.value)),className:"px-3 py-2 rounded-lg border border-theme bg-white dark:bg-gray-800",children:[e.jsx("option",{value:4,children:"Laatste 4 weken"}),e.jsx("option",{value:8,children:"Laatste 8 weken"}),e.jsx("option",{value:12,children:"Laatste 12 weken"}),e.jsx("option",{value:26,children:"Laatste 6 maanden"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-card rounded-xl border border-theme p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"size-12 rounded-lg bg-blue-500/10 flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-blue-500",children:"description"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:i.totalItems}),e.jsx("p",{className:"text-sm text-secondary",children:"Totaal Items"})]})]})}),e.jsx("div",{className:"bg-card rounded-xl border border-theme p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"size-12 rounded-lg bg-amber-500/10 flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-amber-500",children:"pending"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:i.pendingItems}),e.jsx("p",{className:"text-sm text-secondary",children:"In Afwachting"})]})]})}),e.jsx("div",{className:"bg-card rounded-xl border border-theme p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"size-12 rounded-lg bg-green-500/10 flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-green-500",children:"check_circle"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[i.approvalRatio,"%"]}),e.jsx("p",{className:"text-sm text-secondary",children:"Goedgekeurd"})]})]})}),e.jsx("div",{className:"bg-card rounded-xl border border-theme p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"size-12 rounded-lg bg-purple-500/10 flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-purple-500",children:"schedule"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[i.avgApprovalTime,"u"]}),e.jsx("p",{className:"text-sm text-secondary",children:"Gem. Goedkeuring"})]})]})})]}),e.jsxs("div",{className:"bg-card rounded-xl border border-theme p-5",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Items per Week"}),e.jsx("div",{className:"space-y-3",children:k.map((s,n)=>{const a=i.itemsByWeek[s.replace("Week ","")]||0,t=Math.max(...Object.values(i.itemsByWeek),1),l=a/t*100;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-20 text-sm text-secondary",children:s}),e.jsx("div",{className:"flex-1 bg-gray-100 dark:bg-gray-800 rounded-full h-8 overflow-hidden",children:e.jsx("div",{className:"bg-[#2860E0] h-full flex items-center justify-end px-3 text-white text-sm font-medium transition-all",style:{width:`${l}%`},children:a>0&&a})})]},s)})})]}),e.jsxs("div",{className:"bg-card rounded-xl border border-theme p-5",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Submissions per Gebruiker"}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800/50 border-b border-theme",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 font-semibold",children:"Gebruiker"}),e.jsx("th",{className:"text-right px-4 py-3 font-semibold",children:"Aantal"})]})}),e.jsx("tbody",{children:Object.entries(i.itemsByUser).sort(([,s],[,n])=>n-s).map(([s,n])=>e.jsxs("tr",{className:"border-b border-theme last:border-0",children:[e.jsx("td",{className:"px-4 py-3",children:s}),e.jsx("td",{className:"px-4 py-3 text-right font-medium",children:n})]},s))})]}),Object.keys(i.itemsByUser).length===0&&e.jsx("div",{className:"text-center py-8 text-secondary",children:e.jsx("p",{children:"Geen data beschikbaar"})})]})]}),e.jsxs("div",{className:"bg-card rounded-xl border border-theme p-5",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Verdeling per Doelgroep"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[Object.entries(i.itemsByDoelgroep).map(([s,n])=>e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-secondary mb-1",children:s}),e.jsx("p",{className:"text-2xl font-bold",children:n})]},s)),Object.keys(i.itemsByDoelgroep).length===0&&e.jsx("div",{className:"col-span-full text-center py-8 text-secondary",children:e.jsx("p",{children:"Geen data beschikbaar"})})]})]}),e.jsxs("div",{className:"bg-card rounded-xl border border-theme p-5",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Exporteren"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:D,className:"inline-flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"download"}),"Items per Week"]}),e.jsxs("button",{onClick:A,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"download"}),"Items per Gebruiker"]}),e.jsxs("button",{onClick:I,className:"inline-flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"download"}),"Doelgroep Verdeling"]})]}),e.jsxs("p",{className:"text-sm text-secondary mt-3",children:["Download analytics data als CSV bestand (periode: ",d," weken)"]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-500/10 rounded-lg text-blue-600 dark:text-blue-400",children:[e.jsx("span",{className:"material-symbols-outlined",children:"info"}),e.jsx("p",{className:"text-sm",children:"Deze analytics zijn read-only en gebaseerd op Newsletter Generator data. Wijzig rollen en instellingen via de Admin â†’ Gebruikers pagina."})]})]}):e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"material-symbols-outlined text-6xl text-red-500 mb-4 block",children:"block"}),e.jsx("p",{className:"text-xl font-semibold",children:"Toegang Geweigerd"}),e.jsx("p",{className:"text-secondary mt-2",children:"Je hebt geen toegang tot deze pagina."})]})})}function N(o){const h=o instanceof Date?o:o?.toDate?o.toDate():new Date(o),m=new Date(h.valueOf()),b=(h.getDay()+6)%7;m.setDate(m.getDate()-b+3);const g=new Date(m.getFullYear(),0,4),d=(m-g)/864e5;return 1+Math.ceil(d/7)}export{T as default};
