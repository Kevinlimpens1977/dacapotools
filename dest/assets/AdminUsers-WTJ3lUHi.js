import{r as o,j as e,R as N,u as v,p as k,n as u,q as w,m as R,t as S,w as E}from"./index-CQGTM2DD.js";function A({user:r,onClose:x,onSave:d}){const[m,b]=o.useState("none"),[g,n]=o.useState(!1);o.useEffect(()=>{r&&b(r.appRoles?.nieuwsbriefgenerator??"none")},[r]);const p=async()=>{n(!0);try{await d({appRoles:{nieuwsbriefgenerator:m==="none"?void 0:"administrator"}}),x()}catch(h){console.error("Error saving user roles:",h)}finally{n(!1)}};return r?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-800 shadow-xl w-full max-w-lg overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Gebruiker bewerken"}),e.jsx("button",{onClick:x,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:e.jsx("span",{className:"material-symbols-outlined transform rotate-45",children:"add"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Email"}),e.jsx("div",{className:"px-3 py-2 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300",children:r.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Global Role"}),e.jsxs("div",{className:"px-3 py-2 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 flex items-center gap-2",children:[r.role===N.SUPERVISOR?e.jsx("span",{className:"material-symbols-outlined text-purple-500 text-sm",children:"shield_person"}):e.jsx("span",{className:"material-symbols-outlined text-gray-400 text-sm",children:"person"}),e.jsx("span",{className:"capitalize",children:r.role||"User"})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"De globale rol kan niet hier gewijzigd worden."})]}),e.jsx("div",{className:"h-px bg-gray-200 dark:bg-gray-800"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-4",children:"App Rollen"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Nieuwsbrief Generator"}),e.jsxs("select",{value:m,onChange:h=>b(h.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-blue-500 outline-none transition-shadow",children:[e.jsx("option",{value:"none",children:"Geen toegang (Gebruiker)"}),e.jsx("option",{value:"administrator",children:"Administrator"})]})]})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-800/50 border-t border-gray-200 dark:border-gray-800 flex justify-end gap-3",children:[e.jsx("button",{onClick:x,className:"px-4 py-2 text-gray-600 hover:bg-gray-200/50 rounded-lg transition-colors font-medium",children:"Annuleren"}),e.jsxs("button",{onClick:p,disabled:g,className:"px-4 py-2 bg-[#2860E0] hover:bg-blue-700 text-white rounded-lg transition-colors font-medium flex items-center gap-2",children:[g&&e.jsx("span",{className:"material-symbols-outlined animate-spin text-sm",children:"sync"}),"Opslaan"]})]})]})}):null}function G(){const{isSupervisor:r,user:x}=v(),[d,m]=o.useState([]),[b,g]=o.useState(!0),[n,p]=o.useState(null);o.useEffect(()=>{(async()=>{try{g(!0);const t=k(u,"users"),a=(await w(t)).docs.map(c=>{const l=c.data();return{id:c.id,...l,newsletterRole:l.appRoles?.nieuwsbriefgenerator||"none"}});a.sort((c,l)=>(c.email||"").localeCompare(l.email||"")),m(a)}catch(t){console.error("Error fetching users:",t)}finally{g(!1)}})()},[]);const h=async s=>{if(n)try{const t=R(u,"users",n.id),i={},a=s.appRoles||{};a.nieuwsbriefgenerator?i["appRoles.nieuwsbriefgenerator"]=a.nieuwsbriefgenerator:a.nieuwsbriefgenerator===void 0&&(i["appRoles.nieuwsbriefgenerator"]=S()),Object.keys(i).length>0&&(await E(t,i),m(c=>c.map(l=>{if(l.id===n.id){const j=a.nieuwsbriefgenerator||"none";return{...l,newsletterRole:j,appRoles:{...l.appRoles||{},nieuwsbriefgenerator:a.nieuwsbriefgenerator}}}return l}))),p(null)}catch(t){console.error("Error updating user roles:",t),alert("Er is een fout opgetreden bij het opslaan van de rollen.")}},y=s=>s==="supervisor"?{label:"Supervisor",class:"bg-purple-500/10 text-purple-600 dark:text-purple-400"}:{label:"Gebruiker",class:"bg-gray-500/10 text-gray-600 dark:text-gray-400"},f=s=>s==="administrator"?{label:"Admin",class:"bg-emerald-500/10 text-emerald-600 dark:text-emerald-400"}:{label:"Gebruiker",class:"bg-gray-500/10 text-gray-600 dark:text-gray-400"};return b?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"material-symbols-outlined text-4xl animate-spin text-[#2860E0]",children:"sync"})}):e.jsxs("div",{className:"space-y-6 max-w-7xl",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Gebruikers"}),e.jsx("p",{className:"text-secondary mt-1",children:"Beheer alle gebruikers en hun rollen"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-card rounded-xl border border-theme p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"size-12 rounded-lg bg-blue-500/10 flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-blue-500",children:"group"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:d.length}),e.jsx("p",{className:"text-sm text-secondary",children:"Totaal Gebruikers"})]})]})}),e.jsx("div",{className:"bg-card rounded-xl border border-theme p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"size-12 rounded-lg bg-purple-500/10 flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-purple-500",children:"shield_person"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:d.filter(s=>s.role==="supervisor").length}),e.jsx("p",{className:"text-sm text-secondary",children:"Supervisors"})]})]})}),e.jsx("div",{className:"bg-card rounded-xl border border-theme p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"size-12 rounded-lg bg-emerald-500/10 flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-emerald-500",children:"admin_panel_settings"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:d.filter(s=>s.newsletterRole==="administrator").length}),e.jsx("p",{className:"text-sm text-secondary",children:"App Admins"})]})]})})]}),e.jsx("div",{className:"bg-card rounded-xl border border-theme overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800/50 border-b border-theme",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 font-semibold",children:"Gebruiker"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold",children:"Rol"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold",children:"Nieuwsbrief Generator"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold",children:"Laatste Login"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold",children:"Aangemaakt"}),r&&e.jsx("th",{className:"text-right px-4 py-3 font-semibold",children:"Acties"})]})}),e.jsx("tbody",{children:d.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:r?6:5,className:"px-4 py-12 text-center text-secondary",children:[e.jsx("span",{className:"material-symbols-outlined text-4xl mb-2 block",children:"group"}),e.jsx("p",{children:"Geen gebruikers gevonden"})]})}):d.map(s=>{const t=y(s.role),i=f(s.newsletterRole),a=s.id===x?.uid;return e.jsxs("tr",{className:"border-b border-theme last:border-0 hover:bg-gray-50 dark:hover:bg-gray-800/30",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"size-10 rounded-full bg-[#2860E0] flex items-center justify-center text-white font-medium shrink-0",children:(s.displayName||s.email||"?").charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium flex items-center gap-2",children:[s.displayName||"Onbekend",a&&e.jsx("span",{className:"text-xs text-secondary",children:"(jij)"})]}),e.jsx("p",{className:"text-sm text-secondary",children:s.email})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium ${t.class}`,children:t.label})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium ${i.class}`,children:i.label})}),e.jsx("td",{className:"px-4 py-3 text-secondary text-sm",children:s.lastLogin?new Date(s.lastLogin.toDate?.()||s.lastLogin).toLocaleDateString("nl-NL",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}),e.jsx("td",{className:"px-4 py-3 text-secondary text-sm",children:s.createdAt?new Date(s.createdAt.toDate?.()||s.createdAt).toLocaleDateString("nl-NL",{day:"numeric",month:"short",year:"numeric"}):"-"}),r&&e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("button",{onClick:()=>p(s),className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-500 hover:text-gray-900 dark:hover:text-gray-100",title:"Bewerken",children:e.jsx("span",{className:"material-symbols-outlined",children:"edit"})})})})]},s.id)})})]})}),!r&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-500/10 rounded-lg text-blue-600 dark:text-blue-400",children:[e.jsx("span",{className:"material-symbols-outlined",children:"info"}),e.jsx("p",{className:"text-sm",children:"Als admin heb je alleen-lezen toegang. Neem contact op met een supervisor voor het wijzigen van gebruikersrollen."})]}),n&&e.jsx(A,{user:n,onClose:()=>p(null),onSave:h})]})}export{G as default};
