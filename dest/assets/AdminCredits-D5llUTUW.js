import{u as A,r,j as e,p as z,n as M,q as B}from"./index-CQGTM2DD.js";import{s as F,m as P}from"./CreditService-DuvLykg-.js";import{g as k,a as C}from"./appCredits-Bzdi8Pgk.js";function q({appId:a}){const{isSupervisor:d}=A(),[i,S]=r.useState(a||k()[0]),[u,R]=r.useState([]),[o,w]=r.useState({}),[E,b]=r.useState(!0),[g,U]=r.useState(null),[m,x]=r.useState(null),[p,c]=r.useState({creditsRemaining:0,monthlyLimit:0}),[h,j]=r.useState(!1),y=C(i),N=k();r.useEffect(()=>{(async()=>{try{const t=z(M,"users"),n=await B(t),f={};n.forEach(v=>{f[v.id]=v.data()}),w(f)}catch(t){console.error("Error fetching users:",t)}})()},[]),r.useEffect(()=>{b(!0);const s=F(t=>{R(t),b(!1)});return()=>s()},[]);const l=r.useMemo(()=>u.filter(t=>t.appId===i).map(t=>({...t,email:o[t.uid]?.email||"Onbekend",displayName:o[t.uid]?.displayName||"Onbekend"})).sort((t,n)=>(t.email||"").localeCompare(n.email||"")),[u,o,i]),L=s=>{x(s.uid),c({creditsRemaining:s.creditsRemaining,monthlyLimit:s.monthlyLimit})},I=()=>{x(null),c({creditsRemaining:0,monthlyLimit:0})},O=async s=>{try{j(!0),await P(s,i,p),x(null)}catch(t){console.error("[AppCreditsOverview] Save error:",t),U(t.message)}finally{j(!1)}},G=l.reduce((s,t)=>s+(t.totalUsedThisMonth||0),0),T=l.reduce((s,t)=>s+(t.creditsRemaining||0),0);return e.jsxs("div",{className:"space-y-4",children:[!a&&N.length>1&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-sm font-medium",children:"App:"}),e.jsx("select",{value:i,onChange:s=>S(s.target.value),className:"h-10 px-3 rounded-lg border border-theme bg-card focus:ring-2 focus:ring-[#2860E0] focus:border-transparent",children:N.map(s=>{const t=C(s);return e.jsx("option",{value:s,children:t?.appName||s},s)})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-card rounded-lg border border-theme p-4",children:[e.jsx("p",{className:"text-secondary text-sm",children:"Gebruikers"}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:l.length})]}),e.jsxs("div",{className:"bg-card rounded-lg border border-theme p-4",children:[e.jsx("p",{className:"text-secondary text-sm",children:"Totaal Gebruikt"}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:G}),e.jsx("p",{className:"text-xs text-secondary",children:y?.creditUnitPlural})]}),e.jsxs("div",{className:"bg-card rounded-lg border border-theme p-4",children:[e.jsx("p",{className:"text-secondary text-sm",children:"Totaal Resterend"}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:T}),e.jsx("p",{className:"text-xs text-secondary",children:y?.creditUnitPlural})]})]}),g&&e.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500 rounded-lg text-red-500",children:g}),e.jsx("div",{className:"bg-card rounded-lg border border-theme overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800 border-b border-theme",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 font-semibold",children:"Gebruiker"}),e.jsx("th",{className:"text-center px-4 py-3 font-semibold",children:"Resterend"}),e.jsx("th",{className:"text-center px-4 py-3 font-semibold",children:"Limiet"}),e.jsx("th",{className:"text-center px-4 py-3 font-semibold",children:"Gebruikt"}),d&&e.jsx("th",{className:"text-right px-4 py-3 font-semibold",children:"Acties"})]})}),e.jsx("tbody",{children:E&&l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:d?5:4,className:"px-4 py-8 text-center",children:e.jsx("span",{className:"material-symbols-outlined animate-spin text-2xl",children:"sync"})})}):l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:d?5:4,className:"px-4 py-8 text-center text-secondary",children:"Geen gebruikers met credits gevonden voor deze app"})}):l.map(s=>e.jsxs("tr",{className:"border-b border-theme last:border-0 hover:bg-gray-500/5",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.displayName||"Onbekend"}),e.jsx("p",{className:"text-sm text-secondary",children:s.email})]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:m===s.uid?e.jsx("input",{type:"number",value:p.creditsRemaining,onChange:t=>c(n=>({...n,creditsRemaining:parseInt(t.target.value)||0})),className:"w-20 h-8 px-2 text-center rounded border border-theme bg-gray-100 dark:bg-gray-700",min:"0"}):e.jsx("span",{className:s.creditsRemaining<=0?"text-red-500 font-medium":"",children:s.creditsRemaining})}),e.jsx("td",{className:"px-4 py-3 text-center",children:m===s.uid?e.jsx("input",{type:"number",value:p.monthlyLimit,onChange:t=>c(n=>({...n,monthlyLimit:parseInt(t.target.value)||1})),className:"w-20 h-8 px-2 text-center rounded border border-theme bg-gray-100 dark:bg-gray-700",min:"1"}):s.monthlyLimit}),e.jsx("td",{className:"px-4 py-3 text-center text-secondary",children:s.totalUsedThisMonth||0}),d&&e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center justify-end gap-2",children:m===s.uid?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>O(s.uid),disabled:h,className:"p-2 rounded-lg bg-green-500 text-white hover:bg-green-600 disabled:opacity-50 transition-colors",title:"Opslaan",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:h?"sync":"check"})}),e.jsx("button",{onClick:I,disabled:h,className:"p-2 rounded-lg hover:bg-gray-500/10 transition-colors",title:"Annuleren",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]}):e.jsx("button",{onClick:()=>L(s),className:"p-2 rounded-lg hover:bg-gray-500/10 transition-colors",title:"Bewerken",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})})})})]},s.uid))})]})})]})}function H(){const{isSupervisor:a}=A();return e.jsxs("div",{className:"space-y-6 max-w-7xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Credits"}),e.jsx("p",{className:"text-secondary mt-1",children:a?"Beheer credits en limieten per gebruiker":"Bekijk credit gebruik per app en gebruiker"})]}),e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-medium ${a?"bg-purple-500/10 text-purple-600 dark:text-purple-400":"bg-blue-500/10 text-blue-600 dark:text-blue-400"}`,children:[e.jsx("span",{className:"material-symbols-outlined text-sm",children:a?"edit":"visibility"}),a?"Volledig beheer":"Alleen-lezen"]})]}),e.jsx(q,{}),!a&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-500/10 rounded-lg text-blue-600 dark:text-blue-400",children:[e.jsx("span",{className:"material-symbols-outlined",children:"info"}),e.jsx("p",{className:"text-sm",children:"Als admin heb je alleen-lezen toegang. Neem contact op met een supervisor voor het wijzigen van credits."})]})]})}export{H as default};
