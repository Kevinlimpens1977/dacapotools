import{h as B,k as M,u as P,r as l,j as e,m as j,n as f,o as y,A as _,t as $,w as q}from"./index-BJVU1ABf.js";import{A as u}from"./appCredits-BgLXLukM.js";function W(){const{userId:d}=B(),g=M(),{isSupervisor:A}=P(),[c,D]=l.useState(null),[v,p]=l.useState({}),[E,R]=l.useState(!0),[N,k]=l.useState({}),[G,m]=l.useState({}),[z,b]=l.useState(!1),[i,h]=l.useState({appId:"",amount:10,reason:""}),[w,C]=l.useState(!1),S=async()=>{if(d)try{const s=j(f,"users",d),t=await y(s);if(t.exists())D({id:t.id,...t.data()});else{console.error("User not found"),g("/admin/users");return}const a=Object.keys(u),r={};for(const o of a){const n=j(f,"users",d,"apps",o),x=await y(n);x.exists()?r[o]=x.data():r[o]=null}p(r)}catch(s){console.error("Error fetching details:",s)}finally{R(!1)}};l.useEffect(()=>{S()},[d,g]);const O=(s,t,a)=>{p(r=>({...r,[s]:{...r[s]||{},[t]:a}})),m(r=>({...r,[s]:!1}))},L=async s=>{k(t=>({...t,[s]:!0})),m(t=>({...t,[s]:!1}));try{const t=j(f,"users",d,"apps",s),r={role:(v[s]||{}).role||"user"};await _(t,r,{merge:!0});const o=await y(t);p(n=>({...n,[s]:o.data()})),m(n=>({...n,[s]:!0})),setTimeout(()=>{m(n=>({...n,[s]:!1}))},3e3)}catch(t){console.error(`Error saving ${s}:`,t),alert("Er is een fout opgetreden bij het opslaan.")}finally{k(t=>({...t,[s]:!1}))}},U=s=>{h({appId:s,amount:10,reason:""}),b(!0)},T=async s=>{s.preventDefault(),C(!0);try{const a=await $(q,"adminAdjustCredits")({targetUserId:d,appId:i.appId,amount:parseInt(i.amount,10),reason:i.reason});a.data.success&&(b(!1),await S(),alert(`Succesvol ${a.data.delta} credits toegevoegd.`))}catch(t){console.error("Error adjusting credits:",t),alert(`Fout bij toevoegen credits: ${t.message}`)}finally{C(!1)}};return E?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("span",{className:"material-symbols-outlined text-4xl animate-spin text-[#2860E0]",children:"sync"})}):c?A?e.jsxs("div",{className:"space-y-6 max-w-4xl mx-auto relative",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>g("/admin/users"),className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Gebruiker Details"}),e.jsx("p",{className:"text-secondary text-sm",children:"Beheer app-specifieke instellingen voor deze gebruiker"})]})]}),e.jsxs("div",{className:"bg-card rounded-xl border border-theme p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 border-b border-theme pb-2 flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-lg",children:"person"}),"Algemene Informatie"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-secondary mb-1",children:"Naam"}),e.jsx("div",{className:"text-primary font-medium",children:c.displayName||"Onbekend"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-secondary mb-1",children:"Email"}),e.jsx("div",{className:"text-primary font-medium",children:c.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-secondary mb-1",children:"Globale Rol"}),e.jsx("div",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-sm font-medium bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:c.role==="supervisor"?"Supervisor":"Gebruiker"}),e.jsxs("p",{className:"text-xs text-secondary mt-1 flex items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-xs",children:"lock"}),"Alleen-lezen"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-bold text-xl px-1 flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined",children:"apps"}),"App Instellingen"]}),Object.keys(u).map(s=>{const t=u[s],a=v[s],r=a&&a.creditsRemaining!==void 0,o=t.hasCredits&&r,n=a?.totalGenerations;return e.jsxs("div",{className:"bg-card rounded-xl border border-theme p-6 transition-all hover:border-[var(--color-primary)]",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-lg",children:t.appName}),e.jsx("p",{className:"text-sm text-secondary mt-0.5",children:t.description}),e.jsx("p",{className:"text-xs text-secondary font-mono mt-1",children:s})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a===null&&e.jsx("span",{className:"text-xs bg-gray-100 dark:bg-gray-800 text-secondary px-2 py-1 rounded",children:"Nog niet geconfigureerd"}),G[s]&&e.jsxs("span",{className:"text-xs bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 px-2 py-1 rounded flex items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-sm",children:"check"}),"Opgeslagen"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-secondary mb-2",children:"App Rol"}),e.jsxs("select",{value:a?.role||"user",onChange:x=>O(s,"role",x.target.value),className:"w-full px-3 py-2 bg-[var(--bg-app)] border border-theme rounded-lg focus:outline-none focus:ring-2 focus:ring-[#2860E0]",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"administrator",children:"Administrator"})]})]}),o?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-secondary mb-2",children:"Resterende Credits"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",readOnly:!0,value:a.creditsRemaining,className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-theme rounded-lg focus:outline-none text-secondary cursor-not-allowed",title:"Credits kunnen alleen via de knop hiernaast worden gewijzigd"}),e.jsx("button",{type:"button",onClick:()=>U(s),className:"p-2 bg-[var(--bg-surface-hover)] hover:bg-[var(--bg-surface-active)] text-primary rounded-lg border border-theme transition-colors flex items-center justify-center shrink-0",title:"Credits toevoegen",children:e.jsx("span",{className:"material-symbols-outlined",children:"add"})})]}),t.monthlyLimit&&e.jsxs("p",{className:"text-xs text-secondary mt-1",children:["Limiet: ",t.monthlyLimit," ",t.creditUnitPlural,"/maand"]})]}):t.hasCredits?e.jsx("div",{className:"flex items-center",children:e.jsx("p",{className:"text-sm text-secondary italic",children:"Geen credits geÃ¯nitialiseerd voor deze gebruiker."})}):e.jsx("div",{className:"flex items-center",children:e.jsx("p",{className:"text-sm text-secondary italic",children:"Deze app gebruikt geen credits."})}),n!==void 0&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-3",children:[e.jsx("span",{className:"block text-xs text-secondary uppercase tracking-wider",children:"Totaal Generaties"}),e.jsx("span",{className:"block text-xl font-mono font-medium",children:n})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsxs("button",{onClick:()=>L(s),disabled:N[s],className:"px-4 py-2 bg-[#2860E0] text-white rounded-lg hover:bg-[#1C4DAB] transition-colors disabled:opacity-50 flex items-center gap-2",children:[N[s]?e.jsx("span",{className:"material-symbols-outlined text-sm animate-spin",children:"sync"}):e.jsx("span",{className:"material-symbols-outlined text-sm",children:"save"}),"Rol Opslaan"]})})]},s)})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-blue-500/10 rounded-lg text-blue-600 dark:text-blue-400",children:[e.jsx("span",{className:"material-symbols-outlined mt-0.5",children:"info"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Let op:"})," Wijzigingen worden opgeslagen naar ",e.jsxs("code",{className:"bg-blue-500/20 px-1 rounded",children:["users/","{uid}","/apps/","{appId}"]}),"."]}),e.jsx("p",{children:"Credits kunnen alleen via de (+)-knop worden toegevoegd, dit wordt gelogd voor auditdoeleinden."})]})]}),z&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-card w-full max-w-md rounded-2xl shadow-2xl border border-theme p-6 animate-in zoom-in-95 fade-in duration-200",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-[#2860E0]",children:"add_circle"}),"Credits Toevoegen"]}),e.jsxs("p",{className:"text-sm text-secondary mb-6",children:["Voeg extra credits toe aan ",e.jsx("strong",{children:u[i.appId]?.appName})," voor deze gebruiker."]}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-secondary mb-1",children:"Aantal credits"}),e.jsx("input",{type:"number",min:"1",required:!0,value:i.amount,onChange:s=>h({...i,amount:s.target.value}),className:"w-full px-4 py-2 bg-gray-50 dark:bg-gray-800 border border-theme rounded-lg focus:ring-2 focus:ring-[#2860E0]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-secondary mb-1",children:"Reden (verplicht)"}),e.jsx("textarea",{required:!0,placeholder:"Bijv. incident compensatie, extra testcapaciteit...",value:i.reason,onChange:s=>h({...i,reason:s.target.value}),className:"w-full px-4 py-2 bg-gray-50 dark:bg-gray-800 border border-theme rounded-lg focus:ring-2 focus:ring-[#2860E0] min-h-[80px]"}),e.jsx("p",{className:"text-xs text-secondary mt-1",children:"Dit wordt opgeslagen in de audit logs."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"flex-1 px-4 py-2 border border-theme rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:"Annuleren"}),e.jsxs("button",{type:"submit",disabled:w,className:"flex-1 px-4 py-2 bg-[#2860E0] text-white rounded-lg hover:bg-[#1C4DAB] transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:[w?e.jsx("span",{className:"material-symbols-outlined text-sm animate-spin",children:"sync"}):e.jsx("span",{className:"material-symbols-outlined text-sm",children:"save"}),"Toevoegen"]})]})]})]})})]}):e.jsx("div",{className:"p-4",children:"Geen toegang. Alleen supervisors mogen gebruikersinstellingen beheren."}):e.jsx("div",{className:"p-4",children:"Gebruiker niet gevonden."})}export{W as default};
