import{t as U,w,x as v,n as P,y as A,u as T,r as d,j as e,p as O,q as D}from"./index-CfLVizZX.js";import{g as S,A as N}from"./appCredits-1NRqVBd7.js";v(A,"initAppUser");v(A,"consumeCredits");v(A,"adminAdjustCredits");function F(l){const p=U(P,"users");return w(p,i=>{const m=[];i.forEach(u=>{const o=u.ref.path.split("/");if(o.length===4&&o[0]==="apps"&&o[2]==="users"){const b=o[1],c=o[3];m.push({uid:c,appId:b,...u.data()})}}),l(m)},i=>{console.error("Error in subscribeToAllAppCredits:",i),l([])})}const y={paco:.05,translate:.001};function _(){const{isSupervisor:l}=T(),[p,i]=d.useState([]),[m,u]=d.useState({}),[o,b]=d.useState(!0),c=S();d.useEffect(()=>{(async()=>{try{const r=O(P,"users"),t=await D(r),a={};t.forEach(n=>{a[n.id]=n.data()}),u(a)}catch(r){console.error("Error fetching users:",r)}})()},[]),d.useEffect(()=>{b(!0);const s=F(r=>{i(r),b(!1)});return()=>s()},[]);const x=d.useMemo(()=>{const s={totalCost:0,costPerApp:{},costPerUser:[]};c.forEach(t=>{s.costPerApp[t]={used:0,cost:0}});const r={};return p.forEach(t=>{r[t.uid]||(r[t.uid]={}),r[t.uid][t.appId]=t}),Object.keys(r).forEach(t=>{const a=r[t];let n=0;const C=m[t]||{},j={uid:t,email:C.email||"Onbekend",displayName:C.displayName||"Onbekend",apps:{},totalCost:0};Object.entries(a).forEach(([h,E])=>{const f=E.totalUsedThisMonth||0,k=y[h]||.01,g=f*k;s.costPerApp[h]&&(s.costPerApp[h].used+=f,s.costPerApp[h].cost+=g),j.apps[h]={totalUsedThisMonth:f,cost:g},n+=g}),j.totalCost=n,s.costPerUser.push(j),s.totalCost+=n}),s.costPerUser.sort((t,a)=>a.totalCost-t.totalCost),s},[p,m,c]);return o?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("span",{className:"material-symbols-outlined text-4xl animate-spin text-[#2860E0]",children:"sync"})}):e.jsxs("div",{className:"space-y-6 max-w-7xl",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Kosten"}),e.jsx("p",{className:"text-secondary mt-1",children:"Overzicht van platformkosten per app en gebruiker"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-[#2860E0] to-[#1C4DAB] rounded-xl p-6 text-white",children:[e.jsx("p",{className:"text-white/70 text-sm",children:"Totale Kosten Deze Maand"}),e.jsxs("p",{className:"text-4xl font-bold mt-2",children:["€",x.totalCost.toFixed(2)]}),e.jsxs("p",{className:"text-white/70 text-sm mt-2",children:["Gebaseerd op ",x.costPerUser.length," actieve gebruikers"]})]}),e.jsxs("div",{className:"bg-card rounded-xl border border-theme p-5",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Kosten per App"}),e.jsx("div",{className:"space-y-4",children:c.map(s=>{const r=N[s],t=x.costPerApp[s],a=y[s]||.01;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"size-12 rounded-lg bg-[#2860E0]/10 flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-[#2860E0]",children:s==="paco"?"image":"translate"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:r.appName}),e.jsxs("p",{className:"text-sm text-secondary",children:[t.used," ",r.creditUnitPlural," gebruikt"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xl font-bold",children:["€",t.cost.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-secondary",children:["€",a.toFixed(3)," per ",r.creditUnit]})]})]},s)})})]}),e.jsxs("div",{className:"bg-card rounded-xl border border-theme p-5",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-amber-500",children:"settings"}),"Prijsconfiguratie",!l&&e.jsx("span",{className:"text-xs font-normal text-secondary ml-2",children:"(alleen-lezen)"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:c.map(s=>{const r=N[s],t=y[s]||.01;return e.jsxs("div",{className:"p-4 border border-theme rounded-lg",children:[e.jsx("p",{className:"font-medium mb-2",children:r.appName}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-secondary",children:"€"}),e.jsx("input",{type:"number",step:"0.001",defaultValue:t,className:"flex-1 px-3 py-2 rounded-lg border border-theme bg-white dark:bg-gray-800 disabled:opacity-60 disabled:cursor-not-allowed",disabled:!l,readOnly:!l}),e.jsxs("span",{className:"text-sm text-secondary",children:["per ",r.creditUnit]})]}),l&&e.jsx("p",{className:"text-xs text-secondary mt-2",children:"* Prijswijzigingen momenteel niet actief"})]},s)})})]}),e.jsxs("div",{className:"bg-card rounded-xl border border-theme overflow-x-auto",children:[e.jsx("div",{className:"p-4 border-b border-theme",children:e.jsx("h3",{className:"font-semibold",children:"Kosten per Gebruiker"})}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800/50 border-b border-theme",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 font-semibold",children:"Gebruiker"}),c.map(s=>e.jsx("th",{className:"text-center px-4 py-3 font-semibold",children:N[s]?.appName},s)),e.jsx("th",{className:"text-right px-4 py-3 font-semibold",children:"Totaal"})]})}),e.jsx("tbody",{children:x.costPerUser.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:c.length+2,className:"px-4 py-8 text-center text-secondary",children:"Geen kosten geregistreerd"})}):x.costPerUser.slice(0,20).map(s=>e.jsxs("tr",{className:"border-b border-theme last:border-0 hover:bg-gray-50 dark:hover:bg-gray-800/30",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.displayName||"Onbekend"}),e.jsx("p",{className:"text-sm text-secondary",children:s.email})]})}),c.map(r=>{const t=s.apps[r],a=t?.totalUsedThisMonth||0,n=t?.cost||0;return e.jsx("td",{className:"px-4 py-3 text-center text-secondary",children:a>0?`€${n.toFixed(2)}`:"-"},r)}),e.jsxs("td",{className:"px-4 py-3 text-right font-medium",children:["€",s.totalCost.toFixed(2)]})]},s.uid))})]})]}),e.jsxs("div",{className:"bg-card rounded-xl border border-theme p-5",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Maandelijkse Trend"}),e.jsx("div",{className:"h-48 flex items-center justify-center bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsxs("div",{className:"text-center text-secondary",children:[e.jsx("span",{className:"material-symbols-outlined text-4xl mb-2 block",children:"show_chart"}),e.jsx("p",{className:"text-sm",children:"Kostengrafiek komt binnenkort"})]})})]})]})}export{_ as default};
