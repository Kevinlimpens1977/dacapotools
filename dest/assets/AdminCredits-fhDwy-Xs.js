import{u as N,r as n,j as e,p as O,n as $,q as U}from"./index-BbC9A4N7.js";import{s as B,m as M}from"./CreditService-8IVdtZrX.js";import{g as V,a as y}from"./appCredits-BTE18CD5.js";function D(){const{isSupervisor:l}=N(),[p,v]=n.useState([]),[o,k]=n.useState({}),[w,h]=n.useState(!0),[b,C]=n.useState(null),[i,m]=n.useState(null),[g,x]=n.useState(0),[u,f]=n.useState(!1),c=V();n.useEffect(()=>{(async()=>{try{const s=O($,"users"),a=await U(s),r={};a.forEach(d=>{r[d.id]=d.data()}),k(r)}catch(s){console.error("Error fetching users:",s)}})()},[]),n.useEffect(()=>{h(!0);const t=B(s=>{v(s),h(!1)});return()=>t()},[]);const j=n.useMemo(()=>{const t={};return p.forEach(s=>{t[s.uid]||(t[s.uid]={}),t[s.uid][s.appId]=s}),Object.entries(o).map(([s,a])=>({uid:s,displayName:a.displayName||"Onbekend",email:a.email,credits:t[s]||{}})).sort((s,a)=>(s.email||"").localeCompare(a.email||""))},[p,o]),E=(t,s,a,r)=>{l&&(m({uid:t,appId:s,field:a}),x(r))},S=()=>{m(null),x(0)},A=async()=>{if(!i)return;const{uid:t,appId:s,field:a}=i;try{f(!0);const r={[a]:g};await M(t,s,r),m(null)}catch(r){console.error("[AppCreditsOverview] Save error:",r),C(r.message)}finally{f(!1)}};return e.jsxs("div",{className:"space-y-4",children:[b&&e.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500 rounded-lg text-red-500",children:b}),e.jsx("div",{className:"bg-card rounded-lg border border-theme overflow-x-auto",children:e.jsxs("table",{className:"w-full min-w-[800px]",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800 border-b border-theme",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 font-semibold sticky left-0 bg-gray-100 dark:bg-gray-800 z-10 w-64",children:"Gebruiker"}),c.map(t=>{const s=y(t);return e.jsx("th",{className:"text-center px-4 py-3 font-semibold min-w-[200px] border-l border-theme",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{children:s.appName}),e.jsx("span",{className:"text-xs font-normal text-secondary",children:"(Credits / Limiet)"})]})},t)})]})}),e.jsx("tbody",{children:w&&Object.keys(o).length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:1+c.length,className:"px-4 py-8 text-center",children:e.jsx("span",{className:"material-symbols-outlined animate-spin text-2xl",children:"sync"})})}):j.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:1+c.length,className:"px-4 py-8 text-center text-secondary",children:"Geen gebruikers gevonden"})}):j.map(t=>e.jsxs("tr",{className:"border-b border-theme last:border-0 hover:bg-gray-500/5",children:[e.jsx("td",{className:"px-4 py-3 sticky left-0 bg-card z-10",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm truncate max-w-[200px]",title:t.displayName,children:t.displayName}),e.jsx("p",{className:"text-xs text-secondary truncate max-w-[200px]",title:t.email,children:t.email})]})}),c.map(s=>{const a=t.credits[s],r=a?.creditsRemaining,d=a?.monthlyLimit||y(s).monthlyLimit,R=i?.uid===t.uid&&i?.appId===s&&i?.field==="creditsRemaining",z=a!==void 0;return e.jsx("td",{className:"px-4 py-3 border-l border-theme text-center align-top",children:z?e.jsxs("div",{className:"flex flex-col gap-1 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[R?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"number",value:g,onChange:L=>x(parseInt(L.target.value)||0),className:"w-16 h-7 px-1 text-center text-sm rounded border border-theme bg-gray-100 dark:bg-gray-700",min:"0",autoFocus:!0}),e.jsx("button",{onClick:A,disabled:u,className:"text-green-500 hover:bg-green-500/10 p-1 rounded",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:u?"sync":"check"})}),e.jsx("button",{onClick:S,disabled:u,className:"text-red-500 hover:bg-red-500/10 p-1 rounded",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]}):e.jsx("button",{onClick:()=>E(t.uid,s,"creditsRemaining",r),disabled:!l,className:`font-mono font-medium text-lg ${r===0?"text-red-500":"text-primary"} ${l?"hover:underline cursor-pointer":"cursor-default"}`,title:l?"Klik om te bewerken":"",children:r}),e.jsxs("span",{className:"text-secondary text-xs",children:["/ ",d]})]}),e.jsx("div",{className:"w-24 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mt-1",children:e.jsx("div",{className:`h-full rounded-full ${r===0?"bg-red-500":"bg-[#2860E0]"}`,style:{width:`${Math.min(100,r/d*100)}%`}})})]}):e.jsx("span",{className:"text-secondary text-xs italic",children:"-"})},s)})]},t.uid))})]})}),e.jsx("div",{className:"text-xs text-secondary text-center",children:"* Klik op het aantal credits om te wijzigen (alleen supervisors)."})]})}function F(){const{isSupervisor:l}=N();return e.jsxs("div",{className:"space-y-6 max-w-7xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Credits"}),e.jsx("p",{className:"text-secondary mt-1",children:l?"Beheer credits en limieten per gebruiker":"Bekijk credit gebruik per app en gebruiker"})]}),e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-medium ${l?"bg-purple-500/10 text-purple-600 dark:text-purple-400":"bg-blue-500/10 text-blue-600 dark:text-blue-400"}`,children:[e.jsx("span",{className:"material-symbols-outlined text-sm",children:l?"edit":"visibility"}),l?"Volledig beheer":"Alleen-lezen"]})]}),e.jsx(D,{}),!l&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-500/10 rounded-lg text-blue-600 dark:text-blue-400",children:[e.jsx("span",{className:"material-symbols-outlined",children:"info"}),e.jsx("p",{className:"text-sm",children:"Als admin heb je alleen-lezen toegang. Neem contact op met een supervisor voor het wijzigen van credits."})]})]})}export{F as default};
