import{x as d,y as p,o,w as u,m,n as c,z as l}from"./index-BbC9A4N7.js";import{b as g,a as y}from"./appCredits-BTE18CD5.js";function f(e,t){return m(c,"users",e,"apps",t)}async function h(e,t){if(!y(t))throw new Error(`Unknown app: ${t}`);const n=f(e,t),r=await o(n);if(r.exists())return r.data();const i=g(t);return await l(n,i),console.log(`[CreditService] Initialized credits for user ${e}, app ${t}`),i}async function b(e,t,s){const n=f(e,t);(await o(n)).exists()||await h(e,t);const i={};return typeof s.creditsRemaining=="number"&&(i.creditsRemaining=Math.max(0,s.creditsRemaining)),typeof s.monthlyLimit=="number"&&(i.monthlyLimit=Math.max(1,s.monthlyLimit)),Object.keys(i).length>0&&(await u(n,i),console.log(`[CreditService] Modified credits for user ${e}, app ${t}:`,i)),(await o(n)).data()}function S(e){const t=d(c,"apps");return p(t,s=>{const n=[];s.forEach(r=>{const i=r.id,a=r.ref.parent.parent;a&&n.push({uid:a.id,appId:i,...r.data()})}),e(n)},s=>{console.error("Error in subscribeToAllAppCredits:",s),e([])})}export{b as m,S as s};
